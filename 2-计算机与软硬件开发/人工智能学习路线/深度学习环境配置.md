![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901118952-078bd61f-1be4-4f54-a024-1af13deae9f9.jpeg#averageHue=%23f6f7f4&id=X0Wdb&originHeight=1024&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)原网址：[https://zhuanlan.zhihu.com/p/434239083](https://zhuanlan.zhihu.com/p/434239083" \t "_blank)<br />Abstract:<br />记录一下我是如何配置Windows11 + WSL2(Windows Subsystem for Linux 2) 下的深度学习环境的。<br />Key Words:<br />Linux; Windows; Windows Subsystem for Linux; Deep Learning; CUDA; NVIDIA;

- 在Windows11内安装WSL2

遇事不决，先参考官方文档：<br />[安装 WSL](https://link.zhihu.com/?target=https%3A//docs.microsoft.com/zh-cn/windows/wsl/install)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901119320-4c0ab33d-fc15-4658-bb09-c550facfb4cf.jpeg#averageHue=%231c1c1b&id=hqrxD&originHeight=707&originWidth=952&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />其实很简单，就是在powershell中输入wsl --install就行（这一步需要：右键powershell-以管理员身份运行）。<br />这里默认安装的发行版是Ubuntu，我也推荐安装Ubuntu。<br />这里，我安装的是Ubuntu 20.04 LTS。<br />wsl.exe --install Ubuntu-20.04<br />![](https://cdn.nlark.com/yuque/0/2023/png/35495747/1690901119634-5a1f80c8-ab18-4253-a354-5a5e3e0ab850.png#averageHue=%231b1b1b&id=gIK2Q&originHeight=59&originWidth=439&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

- 在Windows内安装NVIDIA驱动

目前已经有支持WSL用户的NVIDIA驱动版本了，详情参考：<br />[https://docs.nvidia.com/cuda/wsl-user-guide/index.html](https://link.zhihu.com/?target=https%3A//docs.nvidia.com/cuda/wsl-user-guide/index.html)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901119928-1a7a75af-6107-4357-8cae-1f83c90a4d14.jpeg#averageHue=%23b6d0a0&id=d6xV7&originHeight=930&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />**重要：这一步是在Windows系统下安装驱动，不是WSL内！**<br />这里要保证Windows版本，而我已经更新了Windows11（Windows10的话还需要加入Windows Insider Preview，也就是预览版），没有任何系统版本方面的担心。<br />进入驱动(Driver) 下载页面：<br />[https://developer.nvidia.com/cuda/wsl/download](https://link.zhihu.com/?target=https%3A//developer.nvidia.com/cuda/wsl/download)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901120356-8094255c-4c73-4a90-88fd-2fff585cbc4a.jpeg#averageHue=%23b4cc87&id=gAJYK&originHeight=930&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />根据自己的显卡选择版本，一般的笔记本都是GEFORCE系列显卡(如GTX、RTX系列)，QUADRO系列没记错的话一般是图形卡。下载，安装，解决。

- 在LINUX内安装CUDA

进入你的WSL，这里我通过Terminal进入（说了狠方便吧）。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901120831-8aeba371-0947-42b8-b149-3b26b873c044.jpeg#averageHue=%23292424&id=pInVh&originHeight=341&originWidth=664&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />在NVIDIA官网找到你想安装的CUDA版本：<br />[https://developer.nvidia.com/cuda-toolkit-archive](https://link.zhihu.com/?target=https%3A//developer.nvidia.com/cuda-toolkit-archive)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901121185-14eb1966-0401-4fe2-a495-f58ca52649b2.jpeg#averageHue=%23e9eedf&id=W3f6u&originHeight=467&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />这里我安装的是CUDA11.8<br />![](https://cdn.nlark.com/yuque/0/2023/png/35495747/1690901121538-d9f6f0f5-3807-4ed1-9932-a36e0c247fd9.png#averageHue=%23fbfbfb&id=KljqS&originHeight=919&originWidth=958&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />输入命令，安装。<br />wget [https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run](https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run)<br />sudo sh cuda_11.8.0_520.61.05_linux.run<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901121875-8a47ea0f-686a-4cfe-bf0e-3a527acd1b87.jpeg#averageHue=%231c1c1c&id=JYMEf&originHeight=423&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![](https://cdn.nlark.com/yuque/0/2023/png/35495747/1690901122288-de170157-5f62-4754-844f-8b169ff4d0e6.png#averageHue=%23181818&id=L69PL&originHeight=110&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />这里告诉我缺少GCC，执行<br />sudo apt update <br />sudo apt install build-essential<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901122591-4d678f6e-dae3-4da8-823e-a9cc0731aab9.jpeg#averageHue=%231e1e1e&id=hRfcy&originHeight=288&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />这里你也可以选择apt换源：<br />[https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/](https://link.zhihu.com/?target=https%3A//mirrors.tuna.tsinghua.edu.cn/help/ubuntu/)<br />然后再安装CUDA，等待：<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901122970-4283d8ee-24ff-464e-b56f-c77cde20c00f.jpeg#averageHue=%23171717&id=Yo1Vg&originHeight=478&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901123362-88621989-deef-4aa6-862b-ad8962b387e2.jpeg#averageHue=%23121212&id=pix0c&originHeight=563&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />默认只需要CUDA Toolkit11.4，没问题，直接install。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901123836-b264add4-b7a7-46f5-949d-4e6d49bfefa3.jpeg#averageHue=%23171717&id=BmhC6&originHeight=407&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />这样，CUDA就安装好啦！这里注意，安装完成后，Summary下第一行显示Driver: Not Selected，这样才是正常的，因为我们是在Windows下安装了NVIDIA驱动，而非WSL下。

- 安装cuDNN

[https://developer.nvidia.com/rdp/cudnn-archive](https://link.zhihu.com/?target=https%3A//developer.nvidia.com/rdp/cudnn-archive)<br />注意，这里需要注册NVIDIA账号，免费的。<br />找到自己对应的cnDNN版本，我选择了cuDNN v8.2.1 for CUDA 11.x。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901124214-6fae23be-d79c-430c-a3b4-a7bc33512421.jpeg#averageHue=%23dfe5d0&id=NBzXj&originHeight=930&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />但是这一步下载完成之后我发现我是在Windows系统下进行的下载，不过没关系，WSL支持跨文件系统访问。在LINUX中cd到你想要保存cuDNN的路径，输入<br />explorer.exe .<br />直接将Windows中下载的文件拖过来就行。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901124680-7a3ab5a6-2234-45f3-942d-e2ba0a70c763.jpeg#averageHue=%231d1d1c&id=bAAQE&originHeight=587&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />（这里其实可以看到，我一开始尝试使用mv将其移动过来，因为WSL将Windows文件系统挂载到了/mnt，但是路径实在是太长了，我也不知道我输错了啥。）<br />解压，安装，一气呵成

- 安装Anaconda

直接去Anaconda官网安装<br />[https://www.anaconda.com/products/individual#Downloads](https://link.zhihu.com/?target=https%3A//www.anaconda.com/products/individual%23Downloads)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901125034-8fe6f8d8-a436-4ad0-a39e-4f5a92bbc9da.jpeg#averageHue=%23d7ecec&id=h18dY&originHeight=227&originWidth=498&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />下载，运行。<br />sh <filename>.sh<br />一路默认，在某个地方它会提示你是否进行conda init(conda初始化)，默认是no，我选择了yes，建议yes。<br />安装完成后，如果你的shell命令路径前面有一个(base)，说明你已经进入了conda环境，如果没有，输入<br />source ~/.bashrc<br />激活环境（没有选择conda init的话，需要先输入conda init命令）。<br />推荐：修改镜像源，不然有的时候慢得离谱。命令如下：<br />conda config --add channels [https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/](https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/)

conda config --add channels [https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/](https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/)

conda config --add channels [https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/](https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/)

conda config --add channels [https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/](https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/)

conda config --set show_channel_urls yes<br />推荐：创建虚拟环境，避免包冲突<br />conda create -n VE python=3.11<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901125323-fa17c723-eab5-4609-83e5-95ab464a6d2e.jpeg#averageHue=%231b1a1a&id=Bf9k2&originHeight=118&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)这个虚拟环境名字不建议太长。进入自己创建的虚拟环境：<br />conda activate VE<br />一般来说，你每次都需要这样激活虚拟环境，这下知道为什么不建议将名字取太长了吧。<br />然后在虚拟环境中安装PyTorch：<br />[https://pytorch.org/get-started/locally/](https://link.zhihu.com/?target=https%3A//pytorch.org/get-started/locally/)<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901125682-47c1ecca-6f06-4bfc-8816-0e0b3dc1838b.jpeg#averageHue=%23fbf5f4&id=sOOE0&originHeight=552&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />最高支持到CUDA 11.3，别担心，CUDA版本/驱动版本一般能向下兼容。<br />看到下面的命令了吗，如果你这么输入，那么很有可能安装速度会慢到让你怀疑人生，由于我们已经修改了conda源，这里我们直接输入<br />conda install pytorch torchvision torchaudio cudatoolkit=11.3<br />ok，就此安装完成！试一试：<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901126064-fba8c75b-320d-4f65-883c-7ef2ffefd2e3.jpeg#averageHue=%23171717&id=LQxAT&originHeight=258&originWidth=917&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />大功告成！<br />未启动的处理命令（Ubuntu下重启；CMD下设置默认启动系统；更新）<br />netsh winsock reset<br />wsl --set-default-version <Version><br />wsl --update

- 在WSL中安装IDE

这里我使用的是intelliJ Ultimate + Python插件（IntelliJ YYDS！），当然，只需要进行Python开发的话推荐PyCharm。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901126401-ba9c3bea-377b-4b7d-b827-59b07b9a760a.jpeg#averageHue=%23fcf9f9&id=eQIBz&originHeight=425&originWidth=846&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />[IntelliJ IDEA: The Capable & Ergonomic Java IDE by JetBrains](https://link.zhihu.com/?target=https%3A//www.jetbrains.com/idea/)<br />[PyCharm: the Python IDE for Professional Developers by JetBrains](https://link.zhihu.com/?target=https%3A//www.jetbrains.com/pycharm/)<br />下载对应LINUX版本后，解压到你安装应用的目录(/usr/local or /opt)，cd到对应目录，运行：<br />sh <ideaVersion>/bin/idea.sh<br />然后会进入激活页面。这里推荐领取Github学生包：<br />[Engaged students are the result of using real-world tools](https://link.zhihu.com/?target=https%3A//education.github.com/)<br />这样可以免费使用Ultimate版。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901126799-8d6f04fc-a04b-42ba-9e58-e3a62b2f6a6e.jpeg#averageHue=%23363c48&id=oPvV7&originHeight=634&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)IntelliJ安装Python插件<br />Solutions:

- Linux系统字体问题：

由于WSL安装的Ubuntu默认是没有中文字体的，有时候会遇到乱码，我在网上查到并且尝试的解决方案是：将Windows系统字体链接到WSL中。<br /># 链接字体<br />sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/font<br /># 刷新缓存<br />fc-cache -fv

- 在Windows界面快速启动IDE

我们当然不想每次都 { 进入WSL -> cd到IDE目录 -> sh xxxx[.sh](https://link.zhihu.com/?target=http%3A//ide.sh/) } 来启动程序，那能不能在Windows直接启动我们的IDE呢？其实是可以的：使用LINUX包管理器安装的程序，比如<br />sudo apt install firefox<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901127154-26e84bc0-94f5-40f2-a764-ad533b24c4c8.jpeg#averageHue=%23353434&id=bQpxq&originHeight=648&originWidth=606&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />在你的Windows应用目录下会直接生成快捷方式。但是我们手动安装的应用并不会，因此我们需要手动创建快捷方式：<br />首先要知道Linux下的这些快捷方式被保存在了/usr/share/applications/目录：<br />![](https://cdn.nlark.com/yuque/0/2023/png/35495747/1690901127495-2820bd8e-c40c-4a88-8c3b-c67ec4cd32b2.png#averageHue=%231d1c1c&id=PQVB5&originHeight=77&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />于是我们如法炮制<br />![](https://cdn.nlark.com/yuque/0/2023/png/35495747/1690901127805-54b51e60-0f25-41bf-ae21-d433029b7e24.png#averageHue=%23181717&id=K1g7I&originHeight=32&originWidth=865&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />sudoedit intelliJ.desktop<br />以以下形式编辑intelliJ.desktop文件<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901128112-9566b5bf-bfdd-4085-8d6d-960e564e7cdb.jpeg#averageHue=%23232323&id=Gmwtr&originHeight=144&originWidth=620&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />其中[Desktop Entry]，我猜测是一种声明；Exec，很明显，是执行路径，Name名字，Icon图标（事实证明，Icon这条命令没有起到作用）。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901128476-581f8413-0062-40d0-b42d-906dde39de07.jpeg#averageHue=%23383837&id=ByOhl&originHeight=789&originWidth=650&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)保存退出。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901128855-0fb5ed78-e69f-4589-b04a-f3804e0c8c93.jpeg#averageHue=%233a3736&id=EV4aG&originHeight=415&originWidth=567&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />下次就可以直接在此处启动IDE了。

- 在Linux系统非科学上网访问Github

详情参考链接：<br />[https://github.com/dotnetcore/FastGithub](https://link.zhihu.com/?target=https%3A//github.com/dotnetcore/FastGithub)<br />下载release<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901129191-e9f27083-19ef-44e8-ae67-fb3b46d15b7c.jpeg#averageHue=%23fdf8f8&id=THnxv&originHeight=325&originWidth=475&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />采用此方法：<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/35495747/1690901129512-6a12f9ea-cdba-442e-86d1-811623cdfb32.jpeg#averageHue=%23efefeb&id=gUtwj&originHeight=288&originWidth=740&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />（WSL没有systemd服务）<br />设置系统代理可以通过在~/.bashrc文件中添加：<br />export ALL_PROXY=http://127.0.0.1:38457

占位程序报错修复：netsh winsock reset

解决报错：TypeError: load() missing 1 required positional argument: ‘Loader‘<br />报错语句：self.update(yaml.load(fo.read()))<br />报错原因：yaml 5.1版本后不再使用yaml.load(file)，而是是使用##<br />修改如下：self.update(yaml.load(fo.read(),Loader = yaml.FullLoader))
